<div class="blue-back">
  <% if @group.name.nil? %>
    <h4 class="lato white heavy">Add an expense to your group:</h4 class="lato white heavy">
  <% else %>
    <h4 class="lato white heavy">Add an expense to <%= @group.name %>:</h4 class="lato white heavy">
  <% end %>
</div>
<div class="container">
  <h4 class="lato heavy">Name your expense:</h4>
</div>
<%= simple_form_for [:extension, @expense] do |f| %>
  <%= f.input :title, :class => 'lato heavy lighter', :label => false, placeholder: "i.e Lunch at Dishoom" %>
<% end -%>
<div class="container">
  <h4 class="lato heavy">How Much?</h4>
</div>
<%= simple_form_for [:extension, @expense] do |f| %>
  <%= f.input :amount_cents, :class => 'lato heavy lighter', :label => false %>
<% end -%>
<div class="container">
  <h4 class="lato heavy">With Who?</h4>
</div>
<div class="container testimonial-group">
<div class="row text-center">
  <% @group.users.each do |member| %>
    <div class="col-xs-4">
      <div class="user-selector-area text-center current-user">
        <%= image_tag member.profile_picture_url, class: "avatar-scroll" %>
        <p><%= member.first_name %></p>
      </div>
    </div>
  <% end %>
  <div class="col-xs-3">1</div>
  <div class="col-xs-3">2</div>
  <div class="col-xs-3">3</div>
  <div class="col-xs-3">4</div>
  <div class="col-xs-3">5</div>
  <div class="col-xs-3">6</div>
  <div class="col-xs-3">7</div>
  <div class="col-xs-3">8</div>
  </div>
</div>
 <div class="container">
  <h4 class="lato heavy">More Information:</h4>
</div>
<%= simple_form_for [:extension, @expense] do |f| %>
  <%= f.input :description, :class => 'lato heavy lighter', :label => false, :type => "text" %>
<% end -%>
<button class="send-btn"><div class="send-inner"><img src="https://png.icons8.com/paper-plane/ios11/30/ffffff" class="paper-plane" >Add Expense</div></button>



<h3>Group ID: <%= @group.id %></h3>
<h3>User ID: <%= @user.id %></h3>

<div class="spacer"></div>
<button class="send-btn"><div class="send-inner"><img src="https://png.icons8.com/paper-plane/ios11/30/ffffff" class="paper-plane" >Add Expense</div></button>


<!-- JAVASCRIPT FOR THE BUTTON TO SEND TO GROUP AND CLOSE BROWSER -->
<% content_for(:after_js) do %>
  <script>
    console.log("<%= @user.first_name %>");
    document.querySelector(".send-btn").addEventListener("click", () => {
      console.log("<%= @user.first_name %>");
      let message = {
                    "attachment":{
                      "type":"template",
                      "payload":{
                        "template_type":"generic",
                        "elements": [{
                          "title":"<%= @user.first_name %> just added an expense to your Kitty!",
                          "subtitle": "Kitty: Money Sharing Made Simple",
                          "default_action":{
                            "type":"web_url",
                            "url": "https://kittymoneysplitting.herokuapp.com/"
                          },
                          "buttons":[{
                            "type":"web_url",
                            "url":"<%= ENV['NGROK'] %>/extension/groups/<%= @group.id %>?user_id=<%= @user.id %>&group_id=<%= @group.id %>",
                            "title":"Check Out Kitty"
                          }]
                        }]
                      }
                    }
                  };

      MessengerExtensions.beginShareFlow(function(share_response) {
        // User dismissed without error, but did they share the message?
        if(share_response.is_sent){
          // The user actually did share.
          // Perhaps close the window w/ requestCloseBrowser().
          MessengerExtensions.requestCloseBrowser(function success() {
            // webview closed
          }, function error(err) {
            // an error occurred
          });
        }
      },
      function(errorCode, errorMessage) {
      // An error occurred in the process

      },
      message,
      "current_thread");
          });

  </script>
<% end %>

