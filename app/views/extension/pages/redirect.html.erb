<% @title = "Loading..." %>

<div class="loading-container text-center">
    <%= image_tag("White on Colour.png", size: '200', alt: "Edit", class: "loading-logo-img centered") %>
      <% fun_arr = ["Howdy!", "Well met!", "Compawling the databse","How you doin'?"] %>
    <div class="align-top">
    <h3 class="lato white heavy"><%= fun_arr.sample %></h3>

    </div>
</div>

<% content_for(:after_js) do %>
  <script>
    window.extAsyncInit = function() {
      let getdetails = function(result) {
        fetch("/api/v1/users", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ user: result })
          })
            .then(response => response.json())
            .then((data) => {
              window.location.replace(data.url)
            });
      }

      MessengerExtensions.getContext('2048729172013795',
        getdetails,
        function error(result){
          document.body.append("error", result);
        });

      MessengerExtensions.askPermission(
        function(permission_response) {
          // Person grants or rejects the asked permission.
          let permissions = permission_response.permissions; // list of all permissions granted
          let isGranted = permission_response.isGranted;
          // document.body.append(permissions);
          if (isGranted) {
            // User has granted user_profile permission
          }

        }, function(errorCode, errorMessage) {
          // Error occurred
        },
        "user_profile"
      );
    };
  </script>
<% end %>
