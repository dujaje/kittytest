<div>
  <%= image_tag 'Logo.png', style: 'height:auto;width:100%;' %>
  <h4 class="welcome-text nunito">Splitting money <br> made simple</h4>
</div>
<div class="container no-top-marg">
  <h3 class="lato heavy"><strong>How Kitty works:</strong></h3>
  <div class="line-spaced"><p class="less-pad">Setup Kitty in any group chat</p></div>
  <div class="line-spaced"><p class="less-pad">Easily track shared expenses with any members of the group</p></div>
  <div class="line-spaced"><p class="less-pad">Let Kitty simplify the repayments</p></div>
  <div class="line-spaced"><p class="less-pad">Automatically let people know when you repay!</p></div>
</div>
<div class="central mini-margin">
    <h6 class="heavy">Name your kitty:</h6>
</div>
<div class="central">
  <input type="text" placeholder="i.e. Jamie and Lenny's Kitty" class="lato name-input form-control">
</div>
<div class="spacer"></div>
<button class="send-btn"><div class="send-inner"><img src="https://png.icons8.com/paper-plane/ios11/30/ffffff" class="paper-plane" >Setup Your Group Kitty</div></button>


<script>
  window.extAsyncInit = function() {
    let getdetails = function (result) {
      fetch("/api/v1/users", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ user: result })
        })
          .then(response => response.json())
          .then((data) => {
          });
    }
    MessengerExtensions.getContext('2048729172013795',
      getdetails,
      function error(result){
        // document.body.append("error", result);
      });
    MessengerExtensions.askPermission(
      function(permission_response) {
        // Person grants or rejects the asked permission.
        let permissions = permission_response.permissions; // list of all permissions granted
        let isGranted = permission_response.isGranted;

        if (isGranted) {
          // User has granted user_profile permission
        }
      }, function(errorCode, errorMessage) {
        // Error occurred
      },
    );
    };
</script>

<% content_for(:after_js) do %>
  <script>
    document.querySelector(".send-btn").addEventListener("click", () => {
      console.log("hi");
      let message = {
                    "attachment":{
                      "type":"template",
                      "payload":{
                        "template_type":"generic",
                        "elements": [{
                          "title":"Jamie just started a Kitty for this group!",
                          "subtitle": "Kitty: Money Sharing Made Simple",
                          "default_action":{
                            "type":"web_url",
                            "url": "https://kittymoneysplitting.herokuapp.com/"
                          },
                          "buttons":[{
                            "type":"web_url",
                            "url":"https://f5aa87a1.ngrok.io/extension/group/1",
                            "title":"Check Out Kitty"
                          }]
                        }]
                      }
                    }
                  };

      MessengerExtensions.beginShareFlow(function(share_response) {
        // User dismissed without error, but did they share the message?
        if(share_response.is_sent){
          // The user actually did share.
          // Perhaps close the window w/ requestCloseBrowser().
        }
      },
      function(errorCode, errorMessage) {
      // An error occurred in the process

      },
      message,
      "current_thread");
          });

  </script>
<% end %>
